<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <script>
    // 強制將任何 /archives/ 請求改向官方 CDN
    (function(){
      const CDN_HOST = "https://pygame-web.github.io";
      const _fetch = window.fetch;
      window.fetch = function(resource, init){
        if (typeof resource === 'string' && resource.startsWith('/archives/')) {
          resource = CDN_HOST + resource;
        }
        return _fetch.call(this, resource, init);
      }
      const _open = XMLHttpRequest.prototype.open;
      XMLHttpRequest.prototype.open = function(method, url){
        if (typeof url === 'string' && url.startsWith('/archives/')) {
          url = CDN_HOST + url;
        }
        return _open.apply(this, [method, url, ...Array.prototype.slice.call(arguments, 2)]);
      }
    })();
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>塔路之戰 Tower Defense</title>

  <!-- 背景樣式 -->
  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: linear-gradient(180deg, #090b18 0%, #15182b 100%);
      color: #e5e7eb;
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
      user-select: none;
    }

    #canvas {
      width: 100vw;
      height: 100vh;
      display: block;
      background: #000;
    }

    /* 載入動畫 */
    #loader {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(12, 15, 30, 0.95);
      color: #a7b2ff;
      font-size: 18px;
      letter-spacing: 1px;
      z-index: 9999;
    }

    #loader span {
      margin-top: 10px;
      animation: blink 1.2s infinite alternate;
    }

    @keyframes blink {
      from { opacity: 0.4; }
      to { opacity: 1; }
    }

    #status {
      position: fixed;
      bottom: 6px;
      right: 12px;
      font-size: 12px;
      opacity: 0.5;
    }
  </style>
</head>

<body>
  <div id="loader">
    <img src="favicon.png" alt="logo" width="200" style="margin-bottom:12px;"/>
    <div>塔路之戰<br/>Tower Defense</div>
    <span>載入中...</span>
  </div>

  <canvas id="canvas"></canvas>
  <div id="status">powered by pygbag + pygame</div>

  <script>
    // ---- pygbag WebAssembly setup ----
    const loader = document.getElementById("loader");

    var Module = {
      canvas: (function() { return document.getElementById('canvas'); })(),
      onRuntimeInitialized() {
        // 移除載入畫面
        loader.style.display = "none";
        console.log("PyGame Runtime initialized.");
      }
    };

    // 提示：第一次互動後可啟用音樂
    document.body.addEventListener('click', () => {
      console.log("User interaction detected — audio context should be unlocked now.");
    });
    // 強制用絕對 CDN，而不是相對路徑
    window.pygbag = {
      cdn: "https://pygame-web.github.io/archives/0.9/",
      repo: "https://pygame-web.github.io/archives/repo/"
    };
  </script>
  <!-- 這裡的檔名會在打包後自動替換為你的 js 主檔 -->
  <script>
    (function(){
      const candidates = ["app.js", "main.js", "game.js"]; // 常見輸出檔名
      function tryNext(i){
        if(i >= candidates.length){ console.error("找不到打包輸出的 .js 檔"); return; }
        const s = document.createElement('script');
        s.src = candidates[i];
        s.onload = () => console.log("Loaded:", s.src);
        s.onerror = () => { s.remove(); tryNext(i+1); };
        document.body.appendChild(s);
      }
      tryNext(0);
    })();
  </script>
</body>
</html>